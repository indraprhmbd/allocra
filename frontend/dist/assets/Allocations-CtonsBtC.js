import{c as h,d as E,g as D,a as r,b as s,h as n,u as d,i as x,w as p,F as w,j as L,l as u,o as a,e as C,f as $,t as f,A as M,z as T,_ as F}from"./index-D3iJgDdo.js";import{I as O,_ as S,a as q}from"./ModalBase.vue_vue_type_script_setup_true_lang-D0t658v_.js";import{_ as z}from"./DataTable.vue_vue_type_script_setup_true_lang-CrsMgw0y.js";import{a as _}from"./api-Ca2zvfGq.js";var V=h("outline","alert-circle","AlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);var B=h("outline","chevron-down","ChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);var j=h("outline","chevron-up","ChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]);const P={class:"space-y-8"},U={class:"flex items-end justify-between"},J={class:"bg-surface border border-border rounded-sm overflow-hidden"},W={class:"text-accent font-mono"},G=["onClick"],H={key:0,class:"bg-red-500/5 border-b border-border p-6 flex gap-6 items-start animate-fade"},K={class:"space-y-3"},Q={class:"text-xs font-bold text-red-500 uppercase tracking-widest"},X={class:"text-sm text-muted max-w-2xl"},Y={class:"text-primary font-mono"},Z={class:"flex gap-4 pt-2"},ee=["onClick"],te=["onClick"],se=E({__name:"Allocations",setup(oe){const{toast:c}=T(),l=u(!1),i=u([]),g=u(!1),A=[{key:"id",label:"ID",class:"w-24 font-mono text-xs"},{key:"room_id",label:"Resource ID",class:"font-mono"},{key:"timeRange",label:"Time Scope"},{key:"status",label:"Execution_Status",class:"text-right"},{key:"expand",label:"",class:"w-10"}],v=u([]),I=async o=>{try{await _.patch(`/bookings/${o.id}/force`),c(`Node ${o.room_id} preempted & reallocated`,"success"),m()}catch{c("Preemption failed","error")}},R=async(o,e)=>{try{await _.patch(`/bookings/${o}/${e}`),c(`Allocation ${e}d successfully`,"success"),m()}catch{c(`Action failed: ${e}`,"error")}},m=async()=>{g.value=!0;try{const o=await _.get("/bookings/all");v.value=o.data.map(e=>({...e,displayId:`AL-${e.id}`,timeRange:`${new Date(e.start_time).toLocaleString()} - ${new Date(e.end_time).toLocaleTimeString()}`}))}catch{console.error("Failed to fetch allocations")}finally{g.value=!1}};D(()=>{m()});const N=o=>{const e=i.value.indexOf(o);e>-1?i.value.splice(e,1):i.value.push(o)},y=o=>i.value.includes(o);return(o,e)=>{const b=M("AllocationForm");return a(),r("div",P,[s("div",U,[e[5]||(e[5]=s("div",null,[s("h2",{class:"text-2xl font-bold text-primary tracking-tight"}," Allocation Requests "),s("p",{class:"text-muted text-sm mt-1"}," Review pending resource reservations and resolve engine-detected conflicts. ")],-1)),s("button",{onClick:e[0]||(e[0]=t=>l.value=!0),class:"bg-accent hover:bg-accent-hover text-white text-xs font-bold uppercase tracking-widest px-4 py-2 rounded-sm transition-colors flex items-center gap-2"},[n(d(O),{size:16}),e[4]||(e[4]=x(" NEW_ALLOCATION ",-1))])]),s("div",J,[n(z,{columns:A,items:v.value},{id:p(({item:t})=>[s("span",W,f(t.displayId),1)]),status:p(({value:t})=>[n(q,{status:t,variant:t==="allocated"?"info":t==="pending"?"default":"error"},null,8,["status","variant"])]),expand:p(({item:t})=>[t.conflict?(a(),r("button",{key:0,onClick:k=>N(t.id),class:"text-muted hover:text-primary p-1"},[y(t.id)?(a(),C(d(j),{key:0,size:16})):(a(),C(d(B),{key:1,size:16}))],8,G)):$("",!0)]),_:1},8,["items"]),(a(!0),r(w,null,L(v.value,t=>(a(),r(w,{key:"conflict-"+t.id},[y(t.id)?(a(),r("div",H,[n(d(V),{size:24,class:"text-red-500 shrink-0"}),s("div",K,[s("h4",Q," Conflict Detected: "+f(t.conflict?.type),1),s("p",X,[e[6]||(e[6]=x(" This request overlaps with active allocation ",-1)),s("span",Y,f(t.conflict?.overlapping_id),1),x(". "+f(t.conflict?.details),1)]),s("div",Z,[s("button",{onClick:k=>I(t),class:"flex-1 bg-accent hover:bg-accent-hover text-white text-[10px] font-bold uppercase py-2.5 rounded-sm transition-colors"}," FORCE_ALLOCATE ",8,ee),s("button",{onClick:k=>R(t.id,"reject"),class:"flex-1 border border-border hover:bg-white/5 text-muted hover:text-primary text-[10px] font-bold uppercase py-2.5 rounded-sm transition-colors"}," CONFIRM_REJECTION ",8,te)])])])):$("",!0)],64))),128))]),n(S,{show:l.value,title:"New Allocation Request",onClose:e[3]||(e[3]=t=>l.value=!1)},{default:p(()=>[n(b,{onCancel:e[1]||(e[1]=t=>l.value=!1),onSubmit:e[2]||(e[2]=t=>l.value=!1)})]),_:1},8,["show"])])}}}),ce=F(se,[["__scopeId","data-v-17792c22"]]);export{ce as default};
