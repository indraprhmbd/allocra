import{I as F}from"./IconAlertCircle-BMTqImMW.js";import{c as I,d as L,g as O,o as l,a as p,A as U,b as e,j as d,u as m,k as _,x as k,z as V,F as C,i as R,t as v,y as S,m as x,B as M,_ as N,w as h,e as T,f as $}from"./index-CE_jnT5K.js";import{a as q,I as P,M as z,_ as B}from"./ModalBase-CiHtc7mG.js";import{_ as Y}from"./DataTable.vue_vue_type_script_setup_true_lang-bU4LdcD9.js";import{a as g}from"./api-Ca2zvfGq.js";import{I as j}from"./IconClock-CPjfWkCF.js";var G=I("outline","calendar","Calendar",[["path",{d:"M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12",key:"svg-0"}],["path",{d:"M16 3v4",key:"svg-1"}],["path",{d:"M8 3v4",key:"svg-2"}],["path",{d:"M4 11h16",key:"svg-3"}],["path",{d:"M11 15h1",key:"svg-4"}],["path",{d:"M12 15v3",key:"svg-5"}]]);var X=I("outline","chevron-down","ChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);var W=I("outline","chevron-up","ChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]);const J={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Q={class:"md:col-span-2 space-y-2"},H={class:"text-[10px] font-mono text-muted uppercase tracking-widest flex items-center gap-2"},K=["value"],Z={class:"space-y-2"},ee={class:"text-[10px] font-mono text-muted uppercase tracking-widest flex items-center gap-2"},te={class:"space-y-2"},oe={class:"text-[10px] font-mono text-muted uppercase tracking-widest flex items-center gap-2"},se={class:"flex justify-end gap-3 pt-4"},ae=L({__name:"AllocationForm",emits:["submit","cancel"],setup(D,{emit:f}){const c=f,{toast:u}=M(),a=x({room_id:"",user_id:1,start_time:"",end_time:""}),y=x([]),b=async()=>{try{const i=await g.get("/rooms");y.value=i.data}catch{console.error("Failed to load resources for form")}},w=async()=>{if(!a.value.room_id){u("Please select a resource","error");return}try{const i={...a.value,room_id:parseInt(a.value.room_id),start_time:new Date(a.value.start_time).toISOString(),end_time:new Date(a.value.end_time).toISOString()};await g.post("/bookings",i),u("Allocation request executed","success"),c("submit")}catch(i){const t=i.response?.data?.error||"Allocation failed";u(t,"error")}};return O(()=>{b()}),(i,t)=>(l(),p("form",{onSubmit:U(w,["prevent"]),class:"space-y-8"},[e("div",J,[e("div",Q,[e("label",H,[d(m(q),{size:12}),t[4]||(t[4]=_(" Target_Resource ",-1))]),k(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>a.value.room_id=n),required:"",class:"w-full bg-background border border-border rounded-sm p-3 text-sm text-primary focus:outline-none focus:border-accent"},[t[5]||(t[5]=e("option",{value:"",disabled:""},"SELECT_RESOURCE_FOR_ALLOCATION...",-1)),(l(!0),p(C,null,R(y.value,n=>(l(),p("option",{key:n.id,value:n.id},v(n.name)+" (MAX_CAPACITY: "+v(n.capacity)+") ",9,K))),128))],512),[[V,a.value.room_id]])]),e("div",Z,[e("label",ee,[d(m(G),{size:12}),t[6]||(t[6]=_(" Start_Timestamp ",-1))]),k(e("input",{type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=n=>a.value.start_time=n),required:"",class:"w-full bg-background border border-border rounded-sm p-3 text-sm text-primary focus:outline-none focus:border-accent font-mono appearance-none"},null,512),[[S,a.value.start_time]])]),e("div",te,[e("label",oe,[d(m(j),{size:12}),t[7]||(t[7]=_(" End_Timestamp ",-1))]),k(e("input",{type:"datetime-local","onUpdate:modelValue":t[2]||(t[2]=n=>a.value.end_time=n),required:"",class:"w-full bg-background border border-border rounded-sm p-3 text-sm text-primary focus:outline-none focus:border-accent font-mono"},null,512),[[S,a.value.end_time]])])]),t[9]||(t[9]=e("div",{class:"bg-surface p-4 border border-border rounded-sm flex items-start gap-4"},[e("div",{class:"w-1.5 h-1.5 rounded-full bg-yellow-500 mt-1.5 shadow-[0_0_8px_rgba(234,179,8,0.5)]"}),e("p",{class:"text-[10px] font-mono text-muted leading-relaxed"}," ADVISORY: ENGINE_RESOLUTION_MODE IS CURRENTLY SET TO DETERMINISTIC. OVERLAPPING ALLOCATIONS WILL BE FLAGGED AS CONFLICTS UNLESS EXPLICITLY PERMITTED BY POLICY. ")],-1)),e("div",se,[e("button",{type:"button",onClick:t[3]||(t[3]=n=>c("cancel")),class:"text-xs font-bold font-mono text-muted hover:text-primary px-6 py-3 transition-colors uppercase"}," DISCARD "),t[8]||(t[8]=e("button",{type:"submit",class:"bg-accent hover:bg-accent-hover text-white text-xs font-bold uppercase tracking-widest px-8 py-3 rounded-sm transition-colors shadow-lg shadow-accent/10"}," EXECUTE_ALLOCATION_REQUEST ",-1))])],32))}}),ne=N(ae,[["__scopeId","data-v-340a4366"]]),re={class:"space-y-6"},le={class:"flex flex-col md:flex-row md:items-end justify-between gap-4"},ie={class:"bg-surface border border-border rounded-sm overflow-hidden"},de={class:"overflow-x-auto"},ce={class:"text-accent font-mono"},ue=["onClick"],pe={key:0,class:"bg-red-500/5 border-b border-border p-4 md:p-6 flex flex-col md:flex-row gap-4 md:gap-6 items-start animate-fade"},me={class:"space-y-3"},fe={class:"text-xs font-bold text-red-500 uppercase tracking-widest"},ve={class:"text-sm text-muted max-w-2xl"},xe={class:"text-primary font-mono"},_e={class:"flex gap-4 pt-2"},be=["onClick"],ge=["onClick"],ye=L({__name:"Allocations",setup(D){const{toast:f}=M(),c=x(!1),u=x([]),a=x(!1),y=[{key:"id",label:"ID",class:"w-24 font-mono text-xs"},{key:"room_id",label:"Resource ID",class:"font-mono"},{key:"timeRange",label:"Time Scope"},{key:"status",label:"Execution_Status",class:"text-right"},{key:"expand",label:"",class:"w-10"}],b=x([]),w=async r=>{try{await g.patch(`/bookings/${r.id}/force`),f(`Node ${r.room_id} preempted & reallocated`,"success"),t()}catch{f("Preemption failed","error")}},i=async(r,o)=>{try{await g.patch(`/bookings/${r}/${o}`),f(`Allocation ${o}d successfully`,"success"),t()}catch{f(`Action failed: ${o}`,"error")}},t=async()=>{a.value=!0;try{const r=await g.get("/bookings/all");b.value=r.data.map(o=>({...o,displayId:`AL-${o.id}`,timeRange:`${new Date(o.start_time).toLocaleString()} - ${new Date(o.end_time).toLocaleTimeString()}`}))}catch{console.error("Failed to fetch allocations")}finally{a.value=!1}};O(()=>{t()});const n=r=>{const o=u.value.indexOf(r);o>-1?u.value.splice(o,1):u.value.push(r)},E=r=>u.value.includes(r);return(r,o)=>(l(),p("div",re,[e("div",le,[o[5]||(o[5]=e("div",null,[e("h2",{class:"text-2xl font-bold text-primary tracking-tight"}," Allocation Requests "),e("p",{class:"text-muted text-sm mt-1"}," Review pending resource reservations and resolve engine-detected conflicts. ")],-1)),e("button",{onClick:o[0]||(o[0]=s=>c.value=!0),class:"bg-accent hover:bg-accent-hover text-white text-xs font-bold uppercase tracking-widest px-4 py-2 rounded-sm transition-colors flex items-center justify-center gap-2 w-full md:w-auto"},[d(m(P),{size:16}),o[4]||(o[4]=_(" NEW_ALLOCATION ",-1))])]),e("div",ie,[e("div",de,[d(Y,{columns:y,items:b.value},{id:h(({item:s})=>[e("span",ce,v(s.displayId),1)]),status:h(({value:s})=>[d(B,{status:s,variant:s==="approved"?"success":s==="pending"?"default":"error"},null,8,["status","variant"])]),expand:h(({item:s})=>[s.conflict?(l(),p("button",{key:0,onClick:A=>n(s.id),class:"text-muted hover:text-primary p-1"},[E(s.id)?(l(),T(m(W),{key:0,size:16})):(l(),T(m(X),{key:1,size:16}))],8,ue)):$("",!0)]),_:1},8,["items"])]),(l(!0),p(C,null,R(b.value,s=>(l(),p(C,{key:"conflict-"+s.id},[E(s.id)?(l(),p("div",pe,[d(m(F),{size:24,class:"text-red-500 shrink-0"}),e("div",me,[e("h4",fe," Conflict Detected: "+v(s.conflict?.type),1),e("p",ve,[o[6]||(o[6]=_(" This request overlaps with active allocation ",-1)),e("span",xe,v(s.conflict?.overlapping_id),1),_(". "+v(s.conflict?.details),1)]),e("div",_e,[e("button",{onClick:A=>w(s),class:"flex-1 bg-accent hover:bg-accent-hover text-white text-[10px] font-bold uppercase py-2.5 rounded-sm transition-colors"}," FORCE_ALLOCATE ",8,be),e("button",{onClick:A=>i(s.id,"reject"),class:"flex-1 border border-border hover:bg-white/5 text-muted hover:text-primary text-[10px] font-bold uppercase py-2.5 rounded-sm transition-colors"}," CONFIRM_REJECTION ",8,ge)])])])):$("",!0)],64))),128))]),d(z,{show:c.value,title:"New Allocation Request",onClose:o[3]||(o[3]=s=>c.value=!1)},{default:h(()=>[d(ne,{onCancel:o[1]||(o[1]=s=>c.value=!1),onSubmit:o[2]||(o[2]=s=>{c.value=!1,t()})})]),_:1},8,["show"])]))}}),Ae=N(ye,[["__scopeId","data-v-31c7b7b6"]]);export{Ae as default};
